---
output: github_document
always_allow_html: true
editor_options: 
  chunk_output_type: console
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# graphql.parse

<!-- badges: start -->
<!-- badges: end -->

The goal of graphql.parse is to parse GraphQL schemas in an R-style way

## Installation

You can install the development version of graphql.parse like so:

``` r
remotes::install_github("HIBio/graphql.parse)
```

## Example

`query_builder()` walks up and down the schema, enabling users to dynamically select the fields they wish to be returned 

```{r example, eval = FALSE}
library(graphql.parse)
query_string <- query_builder()
```

```{bash, eval = FALSE}
Options in Query; Select next level, or 0 to finish 

 1: object_class             2: meta                     3: target                   4: targets               
 5: disease                  6: diseases                 7: drug                     8: drugs                 
 9: search                  10: associationDatasources  11: interactionResources    12: geneOntologyTerms     
13: up 1 level              

Selection: 7
Options in Drug; Select next level, or 0 to finish 

 1: id                          2: name                        3: synonyms                 
 4: tradeNames                  5: yearOfFirstApproval         6: drugType                 
 7: isApproved                  8: crossReferences             9: maximumClinicalTrialPhase
10: hasBeenWithdrawn           11: blackBoxWarning            12: description              
13: parentMolecule             14: childMolecules             15: approvedIndications      
16: drugWarnings               17: similarEntities            18: literatureOcurrences     
19: mechanismsOfAction         20: indications                21: knownDrugs               
22: adverseEvents              23: linkedDiseases             24: linkedTargets            
25: up 1 level                 

Selection: 1
Options in Drug; Select next level, or 0 to finish 

 1: id                          2: name                        3: synonyms                 
 4: tradeNames                  5: yearOfFirstApproval         6: drugType                 
 7: isApproved                  8: crossReferences             9: maximumClinicalTrialPhase
10: hasBeenWithdrawn           11: blackBoxWarning            12: description              
13: parentMolecule             14: childMolecules             15: approvedIndications      
16: drugWarnings               17: similarEntities            18: literatureOcurrences     
19: mechanismsOfAction         20: indications                21: knownDrugs               
22: adverseEvents              23: linkedDiseases             24: linkedTargets            
25: up 1 level                 

Selection: 19
Options in MechanismsOfAction; Select next level, or 0 to finish 

1: rows
2: uniqueActionTypes
3: uniqueTargetTypes
4: up 1 level

Selection: 1
Options in MechanismOfActionRow; Select next level, or 0 to finish 

1: mechanismOfAction
2: actionType
3: targetName
4: references
5: targets
6: up 1 level

Selection: 1
Options in MechanismOfActionRow; Select next level, or 0 to finish 

1: mechanismOfAction
2: actionType
3: targetName
4: references
5: targets
6: up 1 level

Selection: 3
Options in MechanismOfActionRow; Select next level, or 0 to finish 

1: mechanismOfAction
2: actionType
3: targetName
4: references
5: targets
6: up 1 level

Selection: 5
Options in Target; Select next level, or 0 to finish 

 1: id                     2: alternativeGenes       3: approvedSymbol         4: approvedName        
 5: biotype                6: chemicalProbes         7: dbXrefs                8: functionDescriptions
 9: geneticConstraint     10: genomicLocation       11: geneOntology          12: hallmarks           
13: homologues            14: pathways              15: proteinIds            16: safetyLiabilities   
17: subcellularLocations  18: synonyms              19: symbolSynonyms        20: nameSynonyms        
21: obsoleteSymbols       22: obsoleteNames         23: targetClass           24: tep                 
25: tractability          26: transcriptIds         27: similarEntities       28: literatureOcurrences
29: evidences             30: interactions          31: mousePhenotypes       32: expressions         
33: knownDrugs            34: associatedDiseases    35: up 1 level            

Selection: 1
Options in Target; Select next level, or 0 to finish 

 1: id                     2: alternativeGenes       3: approvedSymbol         4: approvedName        
 5: biotype                6: chemicalProbes         7: dbXrefs                8: functionDescriptions
 9: geneticConstraint     10: genomicLocation       11: geneOntology          12: hallmarks           
13: homologues            14: pathways              15: proteinIds            16: safetyLiabilities   
17: subcellularLocations  18: synonyms              19: symbolSynonyms        20: nameSynonyms        
21: obsoleteSymbols       22: obsoleteNames         23: targetClass           24: tep                 
25: tractability          26: transcriptIds         27: similarEntities       28: literatureOcurrences
29: evidences             30: interactions          31: mousePhenotypes       32: expressions         
33: knownDrugs            34: associatedDiseases    35: up 1 level            

Selection: 3
Options in Target; Select next level, or 0 to finish 

 1: id                     2: alternativeGenes       3: approvedSymbol         4: approvedName        
 5: biotype                6: chemicalProbes         7: dbXrefs                8: functionDescriptions
 9: geneticConstraint     10: genomicLocation       11: geneOntology          12: hallmarks           
13: homologues            14: pathways              15: proteinIds            16: safetyLiabilities   
17: subcellularLocations  18: synonyms              19: symbolSynonyms        20: nameSynonyms        
21: obsoleteSymbols       22: obsoleteNames         23: targetClass           24: tep                 
25: tractability          26: transcriptIds         27: similarEntities       28: literatureOcurrences
29: evidences             30: interactions          31: mousePhenotypes       32: expressions         
33: knownDrugs            34: associatedDiseases    35: up 1 level            

Selection: 35
Options in Target; Select next level, or 0 to finish 

1: mechanismOfAction
2: actionType
3: targetName
4: references
5: targets
6: up 1 level

Selection: 4
Options in Reference; Select next level, or 0 to finish 

1: ids
2: source
3: urls
4: up 1 level

Selection: 2
Options in Reference; Select next level, or 0 to finish 

1: ids
2: source
3: urls
4: up 1 level

Selection: 3
Options in Reference; Select next level, or 0 to finish 

1: ids
2: source
3: urls
4: up 1 level

Selection: 0
query gql( 
   $chemblId: String! 
) { 
   drug(chemblId: $chemblId) { 
      id 
      mechanismsOfAction { 
         rows { 
            mechanismOfAction 
            targetName 
            targets { 
               id 
               approvedSymbol 
            } 
            references { 
               source 
               urls 
            } 
         } 
      } 
   } 
}
```

```{r, echo = FALSE}
library(graphql.parse)
query_string <- "
query gql( 
   $chemblId: String! 
) { 
   drug(chemblId: $chemblId) { 
      id 
      mechanismsOfAction { 
         rows { 
            mechanismOfAction 
            targetName 
            targets { 
               id 
               approvedSymbol 
            } 
            references { 
               source 
               urls 
            } 
         } 
      } 
   } 
}"
```

This `query_string` can then be passed along with the necessary variables to the API

```{r}
run_query(query_string, variables = list(chemblId = "CHEMBL1201828"))
```

The schema can also be fetched once then re-used in additional queries

```{r}
schema <- get_schema()
cat(substring(schema, 1, 50))
```

This can then be used in the `query_builder()` without hitting the endpoint just to retrieve the schema

```{r, eval = FALSE}
query_builder(schema = schema)
```

# Documentation

[This video][otgraphql] provides a great overview of the OpenTargets GraphQL API.

[![](https://img.youtube.com/vi/_sZR0VxpwqE/0.jpg)](https://www.youtube.com/watch?v=_sZR0VxpwqE)

[otgraphql]: https://www.youtube.com/watch?v=_sZR0VxpwqE
